<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Buscador YouTube API v3</title>
  <style>
    #err { color: red; display: none; }
    #status { margin-bottom: 10px; font-weight: bold; }
    ul { list-style-type: none; padding: 0; }
    li { margin-bottom: 8px; }
  </style>
</head>
<body>

<h2>Buscador YouTube (catálogos, cosméticos y calzado)</h2>

<input type="text" id="inputQuery" placeholder="Escribe búsqueda..." style="width:300px;" />
<button id="btnSearch">Buscar</button>

<div id="status"></div>
<div id="err"></div>

<ul id="resultList"></ul>

<script>
  const API_KEY = 'AIzaSyDAQVkMZ_l73dK7pt9gaccYPn5L0vA3PGw'; // Coloca tu API key aquí
  const YT_BASE = 'https://www.googleapis.com/youtube/v3';
  const MAX_RESULTS = 12;

  const $ = id => document.getElementById(id);
  const setStatus = msg => {
    const s = $('status');
    if(s) s.textContent = msg;
    console.log('Estado:', msg);
  };
  const showError = msg => {
    const e = $('err');
    if(e){
      e.style.display = 'block';
      e.textContent = msg;
    }
    console.error('Error:', msg);
  };
  const clearError = () => {
    const e = $('err');
    if(e){
      e.style.display = 'none';
      e.textContent = '';
    }
  };

  async function fetchJson(url) {
    const res = await fetch(url);
    if(!res.ok) {
      throw new Error(`HTTP ${res.status} ${res.statusText}`);
    }
    return res.json();
  }

  async function searchVideos(query) {
    const q = encodeURIComponent(query);
    const url = `${YT_BASE}/search?part=snippet&type=video&maxResults=${MAX_RESULTS}&q=${q}&relevanceLanguage=es&key=${API_KEY}`;
    setStatus('Realizando petición a URL: ' + url);
    return fetchJson(url);
  }

  function renderResults(items) {
    const ul = $('resultList');
    ul.innerHTML = '';
    if(!items || items.length === 0){
      ul.innerHTML = '<li>No se encontraron videos</li>';
      return;
    }
    items.forEach(item => {
      const videoId = item.id.videoId;
      const title = item.snippet.title;
      const published = new Date(item.snippet.publishedAt).toLocaleDateString();
      const li = document.createElement('li');
      li.innerHTML = `<a href="https://www.youtube.com/watch?v=${videoId}" target="_blank" rel="noopener noreferrer">${title}</a> - Publicado: ${published}`;
      ul.appendChild(li);
    });
  }

  $('btnSearch').addEventListener('click', async () => {
    console.log('Botón pulsado');
    clearError();
    setStatus('Buscando videos...');
    const query = $('inputQuery').value.trim();
    if(!query){
      showError('Por favor, escribe un término de búsqueda.');
      setStatus('');
      return;
    }
    try{
      const data = await searchVideos(query);
      console.log('Datos recibidos:', data);
      renderResults(data.items);
      setStatus('Búsqueda completada.');
    } catch(e){
      showError('Error al realizar búsqueda: ' + e.message);
      setStatus('');
    }
  });

  document.addEventListener('DOMContentLoaded', () => {
    setStatus('Listo para buscar.');
  });
</script>

</body>
</html>
